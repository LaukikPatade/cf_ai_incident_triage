name = "ai-incident-triage"
main = "src/worker.ts"
compatibility_date = "2024-01-01"

# Durable Objects binding
[[durable_objects.bindings]]
name = "INCIDENT"
class_name = "IncidentDurableObject"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_classes = ["IncidentDurableObject"]

# Workers AI binding
[ai]
binding = "AI"

# KV Namespaces
[[kv_namespaces]]
binding = "INCIDENT_HISTORY"
id = "preview_id_history"
preview_id = "preview_id_history"

[[kv_namespaces]]
binding = "TEMPLATES"
id = "preview_id_templates"
preview_id = "preview_id_templates"

# Vectorize for semantic search
[[vectorize]]
binding = "VECTORIZE"
index_name = "incident-embeddings"

# Analytics Engine
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Queues for notifications
[[queues.producers]]
binding = "NOTIFICATION_QUEUE"
queue = "incident-notifications"

[[queues.consumers]]
queue = "incident-notifications"
max_batch_size = 10
max_batch_timeout = 30

# R2 for report storage
[[r2_buckets]]
binding = "INCIDENT_REPORTS"
bucket_name = "incident-reports"
preview_bucket_name = "incident-reports-preview"

# CORS configuration
[vars]
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:8787"

